<?xml version="1.0" encoding="utf-8"?>
<mx:HBox xmlns:mx="http://www.adobe.com/2006/mxml">
	<mx:Script>
		<![CDATA[
			import Pattern.AttributeModel;
			import Pattern.OperatorClass;
			
			import fileoperation.SaveToFile;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.controls.Button;
			import mx.controls.Text;
			import mx.events.ValidationResultEvent;
			import mx.rpc.events.ResultEvent;
			import org.act.od.impl.view.ToolPanel;
			[Bindable]
			public var cos:ArrayCollection;
			[Bindable]
			private var attris:ArrayCollection;
			[Bindable]
			private var currentOperator:OperatorClass;
			private var currentIndex:int;
			private var vResult:ValidationResultEvent;
			private var file:FileReferenceList = new FileReferenceList();
			private var f:FileReference;
//			private var loadFromFile:LoadFromFile = new LoadFromFile();
			private function populateForm(event:Event):void
			{
				currentIndex = event.target.selectedIndex;
				currentOperator = event.target.selectedItem;
				operatorName.text = currentOperator.name;
				operatorDescri.text = currentOperator.descri;
				filename.text = currentOperator.filename;
			}
			private function saveAllHandler(event:MouseEvent):void
			{
				var savePatterns:SaveToFile = new SaveToFile();
				savePatterns.saveOperator(cos);
			}
			private function doPatternDelete(event:MouseEvent):void
			{
				cos.removeItemAt(currentIndex);
				resetForm();
			}
			private function resetForm():void
			{
				operatorName.text = null;
				operatorDescri.text = null;
				filename.text = null;
			}
			private function newOperator(event:MouseEvent):void
			{
				ToolPanel.tt = 1;
				file.browse();
				file.addEventListener(Event.SELECT, onFileSelect); 
				file.addEventListener(ProgressEvent.PROGRESS, progressHandle); 
				file.addEventListener(Event.COMPLETE, completeHandle); 
				
			}
			private function onFileSelect(event:Event):void
			{
				for(var i:int=0;i<file.fileList.length;i++){ 
					f = FileReference(file.fileList[i]);  
					//returnedName.text=f.name;
					f.load();
					f.addEventListener(ProgressEvent.PROGRESS, progressHandle); 
					f.addEventListener(Event.COMPLETE, completeHandle); 
					
				}
			}
			private function completeHandle(event : Event) : void {
//				cur = true;
				var data:XML = XML(f.data.toString());
				Alert.show("成功载入算子:"+f.name);
				
				var n:OperatorClass = new OperatorClass(f.name,f.data.toString(),"");
				cos.addItem(n);
//				loadFromFile.data=data;
//				loadFromFile.filename=f.name;
//				loadFromFile.patMods = pms;
//				this.currentState="Construct";
//				loadFromFile.getNet();
			} 
			
			private function progressHandle(event : ProgressEvent) : void { 
				/*progressLabel.text = "complete " + event.bytesLoaded + " bytes"; 
				var fileUploadPercent : uint = event.bytesLoaded / event.bytesTotal * 100; 
				uploadProgressBar.setProgress(fileUploadPercent, 100); 
				uploadProgressBar.label = "Complete " + fileUploadPercent + "%"; */
			} 
			private function changeCodeFile(event:MouseEvent):void{
//				var n:OperatorClass = new OperatorClass("Name","Description","");
//				cos.addItem(n);
			}
		]]>
	</mx:Script>
	
	<mx:Spacer width="50"/>
	<mx:VBox width="200" height="100%" id="List">
		<mx:Label text="自定义算子列表"/>
		<mx:List id="operatorColl" width="200" height="100%" borderStyle="outset"
				 change="populateForm(event)" dataProvider="{cos}" labelField="@name"/>
		<mx:Button label="导入新算子" click="newOperator(event)"/>
		<mx:Button label="保存所有修改" click="saveAllHandler(event)"/>
	</mx:VBox>
	
	
	<mx:StringValidator id="nameV" source="{operatorDescri}" property="text"/>
	
	<mx:Canvas  width="100%" height="100%">
		<mx:VBox horizontalCenter="0">
			<mx:Form id="info">
				<mx:FormItem label="算子操作">
					<mx:HBox>
						<mx:Button label="保存算子" />
						<mx:Button label="删除算子" click="doPatternDelete(event)"/>
					</mx:HBox>
					
				</mx:FormItem>
				<mx:FormItem label="算子名称">
					<mx:TextArea id="operatorName" height="30"/>
				</mx:FormItem>
				<mx:FormItem label="算子描述">
					<mx:TextArea id="operatorDescri" width="300" height="200"/>
				</mx:FormItem>
				<mx:FormItem label="可执行文件">
					<mx:Label id="filename"/>
					<mx:Button label="修改可执行代码" click="changeCodeFile(event)"/>
				</mx:FormItem>
			</mx:Form>
		</mx:VBox>
		
	</mx:Canvas>
</mx:HBox>
